# Uninstall package - stop services and remove user
if [ $1 -eq 0 ]; then
    sensu_services="sensu-client sensu-server sensu-api sensu-dashboard"

    # Disable and stop sensu services
    for service in $sensu_services; do
        /sbin/chkconfig $service off
        /sbin/chkconfig --del $service
        if [ -f "/etc/init.d/$service" ]; then
            /etc/init.d/$service stop || true
            rm /etc/init.d/$service
        fi
        if [ -f "/etc/inittab" ]; then
            if grep -q sensu-runsvdir /etc/inittab; then
                sed '/sensu-runsvdir/d' /etc/inittab > /etc/inittab
                init q
                pkill -HUP sensu-runsvdir || true
            fi
        fi
    done

    # Delete sensu user
    if getent passwd sensu >/dev/null; then
        /usr/sbin/userdel sensu
    fi

    # Delete sensu group
    if getent group sensu >/dev/null; then
        /usr/sbin/groupdel sensu
    fi
fi
