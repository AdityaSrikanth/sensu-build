# Upstart: /etc/init/sensu-api.conf

description "sensu api"

start on (local-filesystems and net-device-up)
stop on [!12345]

respawn

chdir /opt/sensu/bin

EMBEDDED_RUBY=false

if [ -f /etc/default/sensu ]; then
  . /etc/default/sensu
fi

if [ "x$EMBEDDED_RUBY" = "xtrue" ]; then
    export PATH=/opt/sensu/embedded/bin:$ORIG_PATH:/etc/sensu/plugins:/etc/sensu/handlers
else
    export PATH=$ORIG_PATH:/etc/sensu/plugins:/etc/sensu/handlers
fi

env PATH=/etc/sensu/plugins:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

pre-start script
  test -x ./sensu-api || { stop; exit 0; }
end script

exec setuidgid sensu ./sensu-api -l /var/log/sensu/sensu-api.log
